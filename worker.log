
> my-novu-app@0.1.0 xnovu /root/worktree/xnovu-temporal_worker
> tsx cli/index.ts worker start

üöÄ Starting XNovu unified worker...
2025-06-16T10:58:56.368Z [[32minfo[39m] üöÄ Starting XNovu Unified Worker... {"service":"xnovu-worker","env":"development"}
2025-06-16T10:58:56.371Z [[33mwarn[39m] No enterprise IDs specified in WORKER_ENTERPRISE_IDS, worker will run without polling workflows {"service":"xnovu-worker","env":"development"}
2025-06-16T10:58:56.371Z [[32minfo[39m] Worker manager initialized {"service":"xnovu-worker","env":"development","component":"WorkerManager","enterpriseCount":0,"healthPort":3001}
2025-06-16T10:58:56.372Z [[32minfo[39m] Starting worker services... {"service":"xnovu-worker","env":"development","component":"WorkerManager"}
2025-06-16T10:58:56.372Z [[32minfo[39m] Starting Temporal service... {"service":"xnovu-worker","env":"development","component":"WorkerManager"}
2025-06-16T10:58:56.372Z [[32minfo[39m] Initializing Temporal service... {"service":"xnovu-app","env":"development","component":"Temporal"}
2025-06-16T10:58:56.651Z [[32minfo[39m] Namespace 'xnovu-testing' already exists {"service":"xnovu-app","env":"development","component":"Temporal"}
[INFO] 2025-06-16T10:58:56.773Z Creating worker
[INFO] 2025-06-16T10:58:57.970Z asset workflow-bundle-5d41df827beaa4d471be.js 1.04 MiB [emitted] [immutable] (name: main)
runtime modules 937 bytes 4 modules
modules by path ./node_modules/.pnpm/ 287 KiB
  modules by path ./node_modules/.pnpm/@temporalio+common@1.11.8/node_modules/@temporal...(truncated) 95.3 KiB 23 modules
  modules by path ./node_modules/.pnpm/@temporalio+workflow@1.11.8/node_modules/@tempor...(truncated) 139 KiB 19 modules
  ./node_modules/.pnpm/long@5.3.2/node_modules/long/umd/index.js 49.8 KiB [built] [code generated]
  ./node_modules/.pnpm/ms@3.0.0-canary.1/node_modules/ms/dist/index.cjs 3.41 KiB [built] [code generated]
modules by path ./lib/temporal/ 26 KiB
  ./lib/temporal/workflows-autogenerated-entrypoint.cjs 445 bytes [built] [code generated]
  ./lib/temporal/workflows/index.ts 219 bytes [built] [code generated]
  ./lib/temporal/workflows/notification-processing.ts 4.3 KiB [built] [code generated]
  ./lib/temporal/workflows/notification-polling-workflow.ts 7.42 KiB [built] [code generated]
  ./lib/temporal/workflows/scheduling.ts 7.15 KiB [built] [code generated]
  + 2 modules
__temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]
__temporal_custom_failure_converter (ignored) 15 bytes [built] [code generated]
webpack 5.99.9 compiled successfully in 656 ms
[INFO] 2025-06-16T10:58:57.974Z Workflow bundle created
[2m2025-06-16T10:58:58.284148Z[0m [32m INFO[0m [2mtemporal_sdk_core::worker[0m[2m:[0m Initializing worker [3mtask_queue[0m[2m=[0mxnovu-notification-processing [3mnamespace[0m[2m=[0mxnovu-testing
[INFO] 2025-06-16T10:58:58.320Z Worker state changed
2025-06-16T10:58:58.325Z [[32minfo[39m] Temporal service initialized successfully {"service":"xnovu-app","env":"development","component":"Temporal"}
2025-06-16T10:58:58.325Z [[32minfo[39m] Temporal service started successfully {"service":"xnovu-worker","env":"development","component":"WorkerManager"}
2025-06-16T10:58:58.326Z [[32minfo[39m] Starting orchestration workflow... {"service":"xnovu-worker","env":"development","component":"WorkerManager"}
2025-06-16T10:58:58.537Z [[32minfo[39m] Namespace 'xnovu-testing' already exists {"service":"xnovu-app","env":"development","component":"Temporal"}
2025-06-16T10:58:58.584Z [[32minfo[39m] Orchestration workflow started successfully {"service":"xnovu-worker","env":"development","component":"WorkerManager","workflowId":"orchestration-1750071538538"}
2025-06-16T10:58:58.584Z [[33mwarn[39m] No enterprise IDs configured, skipping polling workflows {"service":"xnovu-worker","env":"development"}
2025-06-16T10:58:58.585Z [[32minfo[39m] Starting Health Monitor... {"service":"xnovu-worker","env":"development","component":"HealthMonitor"}
2025-06-16T10:58:58.588Z [[32minfo[39m] Health monitor started {"service":"xnovu-worker","env":"development","component":"HealthMonitor","port":3001}
2025-06-16T10:58:58.588Z [[32minfo[39m] Health Monitor started successfully {"service":"xnovu-worker","env":"development","component":"HealthMonitor","port":3001}
2025-06-16T10:58:58.588Z [[32minfo[39m] Worker services initialization completed completed {"service":"xnovu-worker","env":"development","component":"WorkerManager","duration":2216,"status":"success"}
2025-06-16T10:58:58.589Z [[32minfo[39m] All worker services started successfully {"service":"xnovu-worker","env":"development","component":"WorkerManager","uptime":2,"enterpriseCount":0}
2025-06-16T10:58:58.589Z [[32minfo[39m] ‚úÖ XNovu Unified Worker started successfully {"service":"xnovu-worker","env":"development"}
2025-06-16T10:58:58.589Z [[32minfo[39m] üè• Health check available at http://localhost:3001/health {"service":"xnovu-worker","env":"development"}
[WARN] 2025-06-16T10:58:58.692Z Activity failed
[notificationOrchestrationWorkflow(orchestration-1750071538538)] Started cron scheduling workflow
[notificationOrchestrationWorkflow(orchestration-1750071538538)] Started scheduled notification workflow
[WARN] 2025-06-16T10:58:59.127Z Activity failed
[WARN] 2025-06-16T10:59:00.239Z Activity failed
[WARN] 2025-06-16T10:59:02.351Z Activity failed
[WARN] 2025-06-16T10:59:06.588Z Activity failed
[WARN] 2025-06-16T10:59:14.744Z Activity failed
[Temporal Activity] Triggering notification 799
[INFO] Fetching notification from database {"notificationId":799}
[INFO] Triggering Novu workflow {"notificationId":799,"workflowKey":"yogo-email","recipientCount":1}
[INFO] Notification processing completed {"notificationId":799,"status":"SENT","duration":811,"successCount":1,"totalRecipients":1}
[Temporal Activity] Notification 799 trigger result: {
  success: true,
  status: 'SENT',
  transactionId: 'ad4c689a-b462-426a-9033-5b0a68b6cd8d'
}
[INFO] Fetching notification from database {"notificationId":800}
[INFO] Triggering Novu workflow {"notificationId":800,"workflowKey":"yogo-email","recipientCount":1}
[INFO] Notification processing completed {"notificationId":800,"status":"SENT","duration":431,"successCount":1,"totalRecipients":1}
[INFO] Fetching notification from database {"notificationId":801}
[INFO] Triggering Novu workflow {"notificationId":801,"workflowKey":"yogo-email","recipientCount":1}
[INFO] Notification processing completed {"notificationId":801,"status":"SENT","duration":535,"successCount":1,"totalRecipients":1}
[INFO] Fetching notification from database {"notificationId":802}
[INFO] Triggering Novu workflow {"notificationId":802,"workflowKey":"yogo-email","recipientCount":1}
[INFO] Notification processing completed {"notificationId":802,"status":"SENT","duration":484,"successCount":1,"totalRecipients":1}
[WARN] 2025-06-16T10:59:30.894Z Activity failed
[WARN] 2025-06-16T10:59:30.925Z Activity failed
[WARN] 2025-06-16T11:00:03.011Z Activity failed
[WARN] 2025-06-16T11:00:35.175Z Activity failed
[WARN] 2025-06-16T11:01:07.244Z Activity failed
[notificationOrchestrationWorkflow(orchestration-1750071420068)] Started cron scheduling workflow
[notificationOrchestrationWorkflow(orchestration-1750071420068)] Started scheduled notification workflow
[notificationOrchestrationWorkflow(orchestration-1750071420068)] Orchestration health check - all systems running
[WARN] 2025-06-16T11:02:43.497Z Activity failed
[WARN] 2025-06-16T11:03:15.392Z Activity failed
[notificationOrchestrationWorkflow(orchestration-1750071538538)] Orchestration health check - all systems running
[WARN] 2025-06-16T11:06:59.807Z Activity failed
[cronSchedulingWorkflow(cron-scheduler-1750071420097)] Error in cron scheduling: [ActivityFailure: Activity task failed] {
  cause: Error: Failed to fetch cron rules: column ent_notification_rule.is_active does not exist
      at fetchActiveCronRules (/root/worktree/xnovu-temporal_worker/lib/temporal/activities/supabase.ts:184:11)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Activity.execute (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:104:14)
      at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:131:24)
      at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/worker.ts:1047:24) {
    cause: undefined,
    type: 'Error',
    nonRetryable: false,
    details: [],
    nextRetryDelay: undefined,
    failure: Failure {
      message: 'Failed to fetch cron rules: column ent_notification_rule.is_active does not exist',
      source: 'TypeScriptSDK',
      stackTrace: 'Error: Failed to fetch cron rules: column ent_notification_rule.is_active does not exist\n' +
        '    at fetchActiveCronRules (/root/worktree/xnovu-temporal_worker/lib/temporal/activities/supabase.ts:184:11)\n' +
        '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
        '    at async Activity.execute (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:104:14)\n' +
        '    at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:131:24)\n' +
        '    at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/worker.ts:1047:24)',
      applicationFailureInfo: [ApplicationFailureInfo]
    }
  },
  activityType: 'fetchActiveCronRules',
  activityId: '1',
  retryState: 'MAXIMUM_ATTEMPTS_REACHED',
  identity: '3271301@xclaude',
  failure: Failure {
    message: 'Activity task failed',
    cause: Failure {
      message: 'Failed to fetch cron rules: column ent_notification_rule.is_active does not exist',
      source: 'TypeScriptSDK',
      stackTrace: 'Error: Failed to fetch cron rules: column ent_notification_rule.is_active does not exist\n' +
        '    at fetchActiveCronRules (/root/worktree/xnovu-temporal_worker/lib/temporal/activities/supabase.ts:184:11)\n' +
        '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
        '    at async Activity.execute (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:104:14)\n' +
        '    at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:131:24)\n' +
        '    at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/worker.ts:1047:24)',
      applicationFailureInfo: [ApplicationFailureInfo]
    },
    activityFailureInfo: ActivityFailureInfo {
      scheduledEventId: [Long],
      startedEventId: [Long],
      identity: '3271301@xclaude',
      activityType: [ActivityType],
      activityId: '1',
      retryState: 4
    }
  }
}
[notificationOrchestrationWorkflow(orchestration-1750071420068)] Orchestration health check - all systems running
[WARN] 2025-06-16T11:07:31.551Z Activity failed
[cronSchedulingWorkflow(cron-scheduler-1750071538715)] Error in cron scheduling: [ActivityFailure: Activity task failed] {
  cause: Error: Failed to fetch cron rules: column ent_notification_rule.is_active does not exist
      at fetchActiveCronRules (/root/worktree/xnovu-temporal_worker/lib/temporal/activities/supabase.ts:184:11)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Activity.execute (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:104:14)
      at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:131:24)
      at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/worker.ts:1047:24) {
    cause: undefined,
    type: 'Error',
    nonRetryable: false,
    details: [],
    nextRetryDelay: undefined,
    failure: Failure {
      message: 'Failed to fetch cron rules: column ent_notification_rule.is_active does not exist',
      source: 'TypeScriptSDK',
      stackTrace: 'Error: Failed to fetch cron rules: column ent_notification_rule.is_active does not exist\n' +
        '    at fetchActiveCronRules (/root/worktree/xnovu-temporal_worker/lib/temporal/activities/supabase.ts:184:11)\n' +
        '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
        '    at async Activity.execute (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:104:14)\n' +
        '    at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:131:24)\n' +
        '    at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/worker.ts:1047:24)',
      applicationFailureInfo: [ApplicationFailureInfo]
    }
  },
  activityType: 'fetchActiveCronRules',
  activityId: '1',
  retryState: 'MAXIMUM_ATTEMPTS_REACHED',
  identity: '3271301@xclaude',
  failure: Failure {
    message: 'Activity task failed',
    cause: Failure {
      message: 'Failed to fetch cron rules: column ent_notification_rule.is_active does not exist',
      source: 'TypeScriptSDK',
      stackTrace: 'Error: Failed to fetch cron rules: column ent_notification_rule.is_active does not exist\n' +
        '    at fetchActiveCronRules (/root/worktree/xnovu-temporal_worker/lib/temporal/activities/supabase.ts:184:11)\n' +
        '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
        '    at async Activity.execute (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:104:14)\n' +
        '    at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/activity.ts:131:24)\n' +
        '    at async <anonymous> (/root/worktree/xnovu-temporal_worker/node_modules/.pnpm/@temporalio+worker@1.11.8/node_modules/@temporalio/worker/src/worker.ts:1047:24)',
      applicationFailureInfo: [ApplicationFailureInfo]
    },
    activityFailureInfo: ActivityFailureInfo {
      scheduledEventId: [Long],
      startedEventId: [Long],
      identity: '3271301@xclaude',
      activityType: [ActivityType],
      activityId: '1',
      retryState: 4
    }
  }
}
[WARN] 2025-06-16T11:08:00.167Z Activity failed
[WARN] 2025-06-16T11:08:01.288Z Activity failed
[WARN] 2025-06-16T11:08:03.501Z Activity failed
[WARN] 2025-06-16T11:08:07.658Z Activity failed
[WARN] 2025-06-16T11:08:15.894Z Activity failed
[WARN] 2025-06-16T11:08:31.889Z Activity failed
[WARN] 2025-06-16T11:08:32.008Z Activity failed
[WARN] 2025-06-16T11:08:33.007Z Activity failed
[WARN] 2025-06-16T11:08:35.206Z Activity failed
[WARN] 2025-06-16T11:08:39.355Z Activity failed
[WARN] 2025-06-16T11:08:47.659Z Activity failed
[notificationOrchestrationWorkflow(orchestration-1750071538538)] Orchestration health check - all systems running
[WARN] 2025-06-16T11:09:03.774Z Activity failed
[WARN] 2025-06-16T11:09:04.133Z Activity failed
‚ÄâELIFECYCLE‚Äâ Command failed.
2025-06-16T11:09:34.276Z [[32minfo[39m] Received SIGTERM signal {"service":"xnovu-worker","env":"development"}
2025-06-16T11:09:34.277Z [[32minfo[39m] üìã Received SIGTERM, shutting down worker gracefully... {"service":"xnovu-worker","env":"development"}
2025-06-16T11:09:34.277Z [[32minfo[39m] Starting graceful shutdown... {"service":"xnovu-worker","env":"development","component":"WorkerManager"}

üìã Received SIGTERM, stopping worker...
2025-06-16T11:09:34.278Z [[32minfo[39m] Shutting down Temporal service... {"service":"xnovu-app","env":"development","component":"Temporal"}
[INFO] 2025-06-16T11:09:34.278Z Worker state changed
[2m2025-06-16T11:09:34.278845Z[0m [32m INFO[0m [2mtemporal_sdk_core::worker[0m[2m:[0m Initiated shutdown [3mtask_queue[0m[2m=[0mxnovu-notification-processing [3mnamespace[0m[2m=[0mxnovu-testing
2025-06-16T11:09:34.278Z [[32minfo[39m] Temporal service shut down successfully {"service":"xnovu-app","env":"development","component":"Temporal"}
2025-06-16T11:09:34.279Z [[32minfo[39m] Health monitor stopped {"service":"xnovu-worker","env":"development","component":"HealthMonitor"}
[2m2025-06-16T11:09:34.279544Z[0m [32m INFO[0m [2mtemporal_sdk_core::worker::workflow::workflow_stream[0m[2m:[0m Workflow shutdown is done
[INFO] 2025-06-16T11:09:34.283Z Worker state changed
2025-06-16T11:09:34.284Z [[32minfo[39m] Received SIGTERM signal {"service":"xnovu-worker","env":"development"}
2025-06-16T11:09:34.284Z [[32minfo[39m] üìã Received SIGTERM, shutting down worker gracefully... {"service":"xnovu-worker","env":"development"}
2025-06-16T11:09:34.284Z [[33mwarn[39m] Shutdown already in progress {"service":"xnovu-worker","env":"development"}
‚úÖ Worker exited successfully
